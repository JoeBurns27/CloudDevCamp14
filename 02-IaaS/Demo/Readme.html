<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Markdown Preview</title>
<style>
body{font-family:helvetica, arial, freesans, clean, sans-serif;color:#333;line-height:1.6;font-size:14px}.markdown-body{line-height:1.6;font-size:14px}.markdown-body > *:first-child{margin-top:0 !important}.markdown-body > *:last-child{margin-bottom:0 !important}.markdown-body a.absent{color:#c00}.markdown-body h1{font-weight:700;-webkit-font-smoothing:antialiased;color:#000;font-size:28px;margin:20px 0 10px;padding:0}.markdown-body h2{font-weight:700;-webkit-font-smoothing:antialiased;color:#000;font-size:24px;border-bottom-color:#ccc;border-bottom-width:1px;border-bottom-style:solid;margin:20px 0 10px;padding:0}.markdown-body h3{font-weight:700;-webkit-font-smoothing:antialiased;font-size:18px;margin:20px 0 10px;padding:0}.markdown-body h4{font-weight:700;-webkit-font-smoothing:antialiased;font-size:16px;margin:20px 0 10px;padding:0}.markdown-body h5{font-weight:700;-webkit-font-smoothing:antialiased;font-size:14px;margin:20px 0 10px;padding:0}.markdown-body h6{font-weight:700;-webkit-font-smoothing:antialiased;color:#777;font-size:14px;margin:20px 0 10px;padding:0}.markdown-body blockquote{color:#777;border-left-color:#ddd;border-left-width:4px;border-left-style:solid;margin:15px 0;padding:0 15px}.markdown-body dl{margin:15px 0;padding:0}.markdown-body table{border-collapse:collapse;margin:15px 0;padding:0}.markdown-body pre{border-radius:3px;border:1px solid #ccc;line-height:19px;overflow:auto;font-size:13px;background-color:#f8f8f8;margin:15px 0;padding:6px 10px}.markdown-body li p.first{display:inline-block}.markdown-body dl dt{font-size:14px;font-style:italic;font-weight:700;margin:15px 0 5px;padding:0}.markdown-body dl dt:first-child{padding:0}.markdown-body dl dd{margin:0 0 15px;padding:0 15px}.markdown-body table tr{border-top-color:#ccc;border-top-width:1px;border-top-style:solid;background-color:#fff;margin:0;padding:0}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%}.markdown-body span.frame{overflow:hidden;display:block}.markdown-body span.frame > span{border:1px solid #ddd;width:auto;overflow:hidden;float:left;display:block;margin:13px 0 0;padding:7px}.markdown-body span.frame span img{float:left;display:block}.markdown-body span.frame span span{color:#333;clear:both;display:block;padding:5px 0 0}.markdown-body span.align-center > span{text-align:center;overflow:hidden;display:block;margin:13px auto 0}.markdown-body span.align-center span img{text-align:center;margin:0 auto}.markdown-body span.align-right > span{text-align:right;overflow:hidden;display:block;margin:13px 0 0}.markdown-body span.align-right span img{text-align:right;margin:0}.markdown-body span.float-left{overflow:hidden;margin-right:13px;float:left;display:block}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{overflow:hidden;margin-left:13px;float:right;display:block}.markdown-body span.float-right > span{text-align:right;overflow:hidden;display:block;margin:13px auto 0}.markdown-body pre > code{border:currentColor;white-space:pre;margin:0;padding:0}.markdown-body .highlight pre{border-radius:3px;border:1px solid #ccc;line-height:19px;overflow:auto;font-size:13px;background-color:#f8f8f8;padding:6px 10px}.markdown-body p,.markdown-body li{margin:15px 0}.markdown-body ul,.markdown-body ol{padding-left:30px;margin:15px 0}.markdown-body > h2:first-child,.markdown-body > h1:first-child,.markdown-body > h1:first-child + h2{border:0 currentColor;padding-top:0;margin-top:0}.markdown-body > h3:first-child,.markdown-body > h4:first-child,.markdown-body > h5:first-child,.markdown-body > h6:first-child{padding-top:0;margin-top:0}.markdown-body h1 + p,.markdown-body h2 + p,.markdown-body h3 + p,.markdown-body h4 + p,.markdown-body h5 + p,.markdown-body h6 + p,.markdown-body ul li > :first-child,.markdown-body ol li > :first-child,.markdown-body dl dt > :first-child,.markdown-body dl dd > :first-child,.markdown-body blockquote > :first-child,.markdown-body table tr th > :first-child,.markdown-body table tr td > :first-child{margin-top:0}.markdown-body ul li > :last-child,.markdown-body ol li > :last-child,.markdown-body dl dt > :last-child,.markdown-body dl dd > :last-child,.markdown-body blockquote > :last-child,.markdown-body table tr th > :last-child,.markdown-body table tr td > :last-child{margin-bottom:0}.markdown-body table tr th,.markdown-body table tr td{border:1px solid #ccc;text-align:left;margin:0;padding:6px 13px}.markdown-body span.align-center,.markdown-body span.align-right{overflow:hidden;clear:both;display:block}.markdown-body code,.markdown-body tt{border-radius:3px;border:1px solid #eaeaea;white-space:nowrap;background-color:#f8f8f8;margin:0 2px;padding:0 5px}.markdown-body pre code,.markdown-body pre tt{border:currentColor;background-color:transparent}span.codelanguage{display:none}
</style>
</head>
<body>
<div class="markdown-body">
<p><a name="Title"></a></p>

<h1 id="IaaS_Demos">IaaS Demos</h1>

<hr>

<p><a name="Overview"></a></p>

<h2 id="Overview">Overview</h2>

<p>In these demos we will cover Virtual Machines, Virtual Machine Extensions and Virtual Networks.</p>

<p><a href="#Demo1">Demo 1</a>
<a href="#Demo2">Demo 2</a>
<a href="#Demo3">Demo 3</a></p>

<h2 id="a_hrefDemo4Demo_4a"><a href="#Demo4">Demo 4</a></h2>

<p><a name="Setup"></a></p>

<h2 id="Setup_and_Prerequisites">Setup and Prerequisites</h2>

<p>To successfully complete this demo you need:</p>

<ul>
<li>An Active Azure Account</li>
</ul>

<hr>

<p><a name="Demo1"></a></p>

<h2 id="Demo_1_Create_a_New_Virtual_Machine_from_the_Gallery">Demo 1: Create a New Virtual Machine from the Gallery</h2>

<ol>
<li><p>Log into the Azure Portal at <a href="http://portal.azure.com">http://portal.azure.com</a>.</p>

<p><img src="images/portal.png?raw=true" alt="Portal">
</p></li>
<li><p>Click New</p>

<p><img src="images/new.png?raw=true" alt="New">
</p></li>
<li><p>Click Everything</p>

<p><img src="images/everything.png?raw=true" alt="everything">
</p></li>
<li><p>Click Virtual Machines</p></li>
<li><p>Select a VM from the Gallery and click create.</p>

<p><img src="images/create.png?raw=true" alt="Create">
</p></li>
<li><p>Fill in the information for Host name, user name, and password. Additionally, set any optional configurations for Network, storage, diagnostics and subscription. Be sure to set a location that is geographically located to the majority of your traffic.</p>

<p><img src="images/info2.png?raw=true" alt="Info2">
</p></li>
<li><p>Click &quot;Create&quot; to start VM Creation process.</p></li>
</ol>

<hr>

<p><a name="Demo2"></a></p>

<h2 id="Demo_2_Add_VM_Extension_to_a_New_Virtual_Machine">Demo 2: Add VM Extension to a New Virtual Machine</h2>

<p>To successfully complete this demo you need:</p>

<ul>
<li>An Active Azure Account</li>
<li>A Windows Server 2012 VM has been provisioned.</li>
</ul>

<hr>

<ol>
<li><p>Log into the Azure Portal at <a href="http://portal.azure.com">http://portal.azure.com</a>.</p>

<p><img src="images/portal.png?raw=true" alt="Portal">
</p></li>
<li><p>On the left, click Browse, then click Virtual Machines</p>

<p><img src="images/browsevm.png?raw=true" alt="BrowseVM">
</p></li>
<li><p>Select VM</p>

<p><img src="images/vmselect.png?raw=true" alt="VMSelect">
</p></li>
<li><p>In the journey that comes up, scroll down to the Extensions and Click the box to see the extensions installed.</p>

<p><img src="images/extensions.png?raw=true" alt="Extensions">
</p></li>
<li><p>Click the &quot;+ Add&quot; icon in the header and select the Extension to install.</p>

<p><img src="images/addchef.png?raw=true" alt="AddChef">
</p></li>
<li><p>After reading the installation requirements in information, click &quot;Create&quot; to install the extension.</p>

<p><img src="images/complete.png?raw=true" alt="Complete">
</p></li>
</ol>

<hr>

<p><a name="Demo3"></a></p>

<h2 id="Demo_3_Add_Custom_PowerShell_Script_Extension_to_a_New_Virtual_Machine">Demo 3: Add Custom PowerShell Script Extension to a New Virtual Machine</h2>

<p>To successfully complete this demo you need:</p>

<ul>
<li>An Active Azure Account</li>
<li>Azure PowerShell v0.8 or higher has been installed and configured.</li>
<li>Desired Azure subscription has already been selected. </li>
<li>A storage account has been provisioned under the same Azure subscription.</li>
<li>A scripts container has been created under the storage account with public read access.</li>
<li>A helloworld.ps1 PowerShell script has been uploaded to the container. The content of the script is a single line: write-output “Hello World!”</li>
<li>PowerShell environment has been set with large font for easy reading.</li>
<li>A Windows Server 2012 VM has been provisioned.</li>
</ul>

<hr>

<ol>
<li><p>Start PowerShell command prompt</p></li>
<li><p>Issue the following cmdlet to log in to your Azure account:</p>

<span class="codelanguage">PowerShell</span><pre><code class="PowerShell">Add-AzureAccount
</code></pre></li>
<li><p>Issue the following cmdlets to get a reference to the virtual machine instance:</p>

<span class="codelanguage">PowerShell</span><pre><code class="PowerShell">$serviceName = “[cloud service that hosts the VM]”
$vmName = “[name of the VM]”
$vm = Get-AzureVM –ServiceName $serviceName –Name $vmName
</code></pre></li>
<li><p>Issue the following cmdlet to see what extensions are already installed:</p>

<span class="codelanguage">PowerShell</span><pre><code class="PowerShell">Get-AzureVMExtension –VM $vm
</code></pre></li>
<li><p>Use the following cmdlet <strong>(all on one line)</strong> to enable Custom Script Extension, and instruct it to download and execute the helloworld.ps1 (this takes about 20-30 seconds):</p>

<span class="codelanguage">PowerShell</span><pre><code class="PowerShell">Set-AzureVMCustomScriptExtension -ContainerName scripts -StorageAccountName
'[your storage account name]' -VM $vm -FileName ‘helloworld.ps1'
-Run ‘helloworld.ps1' | Update-AzureVM -Verbose
</code></pre></li>
<li><p>Next, the following cmdlet will retrieve and display the script execution result:</p>

<span class="codelanguage">PowerShell</span><pre><code class="PowerShell">$status = Get-AzureVM -ServiceName $serviceName -Name $vmName
$result = $status.ResourceExtensionStatusList.ExtensionSettingStatus.SubStatusList | Select Name, @{&quot;Label&quot;=&quot;Message&quot;;Expression = {$_.FormattedMessage.Message }} 
$result
</code></pre></li>
</ol>

<hr>

<p><a name="Demo4"></a></p>

<h2 id="Demo_4_Setup_Virtual_Networking_for_Point_To_Site_Network">Demo 4: Setup Virtual Networking for Point To Site Network</h2>

<p>Follow first fifteen steps of the following blog:</p>

<pre><code>http://haishibai.blogspot.com/2013/05/walkthrough-file-sharing-between-your.html
</code></pre>

<ol>
<li><p>Log on to Windows Azure Management Portal.</p></li>
<li><p>On command bar, click on <strong>NEW</strong> button, then select <strong>NETWORKS</strong>-&gt;<strong>VIRTUAL NETWORK</strong>-&gt;<strong>CUSTOM CREATE</strong> menu.</p></li>
<li><p>On <strong>Virtual Network Details</strong> page, enter network <strong>NAME</strong> as <em>pointtosite</em>, create or select a <strong>AFFINITY GROUP</strong>, then click next arrow.</p></li>
<li><p>On <strong>DNS Servers and VPN Connectivity</strong> page, check <strong>Configure Point-to-Site VPN</strong>, then click next arrow:</p>

<p><img src="images/vpn1.png?raw=true" alt="VPN1">
</p></li>
<li><p>On <strong>Point-to-Site Connectivity</strong> page, click next arrow.</p></li>
<li><p>On <strong>Virtual Network Address Spaces</strong> page, click on <strong>add gateway subnet</strong> button, and then click on check icon to complete network creation.</p></li>
<li><p>After the virtual network has been created, open its <strong>DASHBOARD</strong> page, and the click <strong>CREATE GATEWAY</strong> icon to create the dynamic routing gateway.</p></li>
<li><p>Add a new Windows Server 2012 virtual machine to the virtual network. Note that when you specify user credential, make sure to use the same user id and password of your local account. This is because the virtual machine on Windows Azure is not under your domain controller, and we are using the same user credential on both local and virtual machines to allow file sharing.</p></li>
<li><p>As the virtual machine is cooking, let’s create two self-signed certificates: one for root, and another for client identification. During the following steps we’ll need to upload the root certificate to Windows Azure so Windows Azure can validate the client machine using the certificate chain.</p></li>
<li><p>Launch <strong>Developer Command Prompt for VS2012</strong> as administrator. Change current folder to a folder where you want to keep the generated certificates. Here I’ll use folder <strong>c:\books</strong>.</p></li>
<li><p>Use command</p>

<pre><code>makecert -sky exchange -r -n &quot;CN=MyFakeRoot&quot; -pe -a sha1 -len 2048 -ss My
</code></pre>

<p>to create root certificate.</p></li>
<li><p>Use command</p>

<pre><code>makecert -n &quot;CN=MyLaptop&quot; -pe -sky exchange -m 96 -ss My -in &quot;MyFakeRoot&quot; -is my -a sha1
</code></pre>

<p>to create client certificate.</p></li>
<li><p>Launch <strong>certmgr</strong>.</p></li>
<li><p>Export the root certificate as a <strong>MyFakeRoot.cer</strong> file (without private key).</p></li>
<li><p>[Optional] if you are configuring VPN for another client, you’d need to install the client certificate on target machine.</p></li>
<li><p>Go back to Windows Azure Management Portal. On <strong>DASHBOARD</strong> page of the virtual network, click on link <strong>Upload client certificate</strong> to upload the root certificate. Note at this point the gateway should have been created.</p>

<p><img src="images/vpn2.png?raw=true" alt="VPN2">
</p></li>
<li><p>After certificate has been uploaded, you can download and install VPN client from the DASHBOARD page (AMD64 Client link for 64-bit machines, x86 Client link for 32-bit machines).</p></li>
<li><p>After VPN client has been installed, you can see the VPN connection on your Windows network connection list. Click on the network to connect. When prompted by the VPN client, click Connect button to continue.</p></li>
<li><p>[Optional] Now you can use ipconfig/all to verify if VPN connection has been successfully established  (look for PPP adapter).</p></li>
<li><p>Log on to the virtual machine, create a new Share folder under c:. Share the folder with the user you specified when you created the virtual machine. </p></li>
<li><p>On Management Portal, record the virtual machines private IP on its DASHBOARD page. In my case the IP is 10.0.1.4.</p></li>
<li><p>Now you can use Explorer on your local machine and access the shared folder by \10.0.1.4\Share.</p></li>
</ol>

<hr>

</div>
</body>
</html>
